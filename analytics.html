<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Veeyes Analytics</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/map.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/geodata/worldLow.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
    <link rel="stylesheet" href="/css/analytics.css">

    <style>

        .dropdown-select {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-bottom: 20px;
        }

        #popularityChart {
            width: 250px !important;
            height: 250px !important;
        }

        #locationChart {
            width: 250px !important;
            height: 250px !important;
        }

        .percentage-style {
            font-family: 'Libre Baskerville', serif;
            font-size: 15px;
            max-width: 300px;
            margin-top: 50px;
        }

        .item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            padding: 5px 10px;
            border-radius: 12px;
        }

        /* .item.active {
            background-color: #f5f5f5;
        } */

        .dot {
            height: 8px;
            width: 8px;
            border-radius: 50%;
            margin-right: 8px;
            display: inline-block;
        }

        .label {
            flex: 1;
            display: flex;
            align-items: center;
        }

        .value {
            font-weight: 500;
        }

        .general {
            background-color: #56e0d4;
        }

        .pediatric {
            background-color: #00292f;
        }

        .about {
            background-color: #0d6e72;
        }

        .enquiry {
            background-color: #f6dfc4;
        }

        #chartdiv {
            width: 100%;
            height: 500px;
        }

       

        .segment {
            height: 100%;
        }

        .seg-1 {
            background-color: #4CAF50;
        }

        /* Green */
        .seg-2 {
            background-color: #2196F3;
        }

        /* Blue */
        .seg-3 {
            background-color: #f44336;
        }

        .percent {
            width: 40px;
            font-size: 13px;
            text-align: right;
            color: #555;
        }


        .heading{
            font-family: 'Montserrat', sans-serif;
            color: #2c3e50;
            margin-top: 3%;
        }
    </style>
</head>

    <body class="p-4">
        <div class="container-fluid">
            <h3 class="text-center mb-4 heading">Veeyes Dental Hospital Analytics - <span id="currentMonthYear"></span></h3>

            <div class="dropdown-select">
                <select id="yearSelect" class="form-select w-auto">
                    <option value="all" disabled>Year</option>
                    <option value="2023">2023</option>
                    <option value="2024">2024</option>
                    <option value="2025">2025</option>
                </select>
                <select id="monthSelect" class="form-select w-auto">
                    <option value="0">All Months</option>
                    <option value="1">January</option>
                    <option value="2">February</option>
                    <option value="3">March</option>
                    <option value="4">April</option>
                    <option value="5">May</option>
                    <option value="6">June</option>
                    <option value="7">July</option>
                    <option value="8">August</option>
                    <option value="9">September</option>
                    <option value="10">October</option>
                    <option value="11">November</option>
                    <option value="12">December</option>
                </select>
            </div>

            <div class="row g-3 mb-4">
                <div class="col-md-4">
                    <div class="metric-box">
                        <h6>Views</h6>
                        <h2>
                            7,265  
                            <span class="text-success">
                            +11.01% 
                            <span class="material-symbols-outlined" style="font-size: 20px; vertical-align: middle;">
                                trending_up
                            </span>
                            </span>
                        </h2>
                    
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="metric-box">
                        <h6>New Visits</h6>
                        <h2>
                            156   
                            <span class="text-success">
                                +15.03%
                            <span class="material-symbols-outlined" style="font-size: 20px; vertical-align: middle;">
                                trending_up
                            </span>
                            </span>
                        </h2>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="metric-box">
                        <h6>Active Visitors</h6>
                        <h2>
                            2,318  
                            <span class="text-success">
                                +6.08%
                            <span class="material-symbols-outlined" style="font-size: 20px; vertical-align: middle;">
                                trending_up
                            </span>
                            </span>
                        </h2>
                    
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="cards p-3 mb-4 col-md-9" >
                    <h6 class="total-visitors">Total Visitors</h6>
                    <div class="chart-container"><canvas id="visitorsChart"></canvas></div>
                </div>

                <div class="traffic-by-website col-md-3">
                    <div class="traffic-title">Traffic by Website</div>

                    <!-- GOOGLE Example -->
                    <div class="traffic-row">
                        <span class="label">Google</span>
                        <div class="progress-container">
                            <div class="progress-bar">
                                <!-- Assume 30 + 30 + 40 = 100 structure -->
                                <div class="segment seg-1" style="width: 30%;"></div>
                                <div class="segment seg-2" style="width: 30%;"></div>
                                <div class="segment seg-3" style="width: 20%;"></div> <!-- Only 80% reached -->
                            </div>
                        </div>
                        <div class="percent">80%</div>
                    </div>

                    <!-- YouTube -->
                    <div class="traffic-row">
                        <span class="label">YouTube</span>
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="segment seg-1" style="width: 25%;"></div>
                                <div class="segment seg-2" style="width: 25%;"></div>
                                <div class="segment seg-3" style="width: 10%;"></div> <!-- Total 60% -->
                            </div>
                        </div>
                        <div class="percent">60%</div>
                    </div>

                    <!-- Instagram -->
                    <div class="traffic-row">
                        <span class="label">Instagram</span>
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="segment seg-1" style="width: 20%;"></div>
                                <div class="segment seg-2" style="width: 20%;"></div>
                                <!-- Last 40% missed: not shown -->
                            </div>
                        </div>
                        <div class="percent">40%</div>
                    </div>

                    <!-- Facebook -->
                    <div class="traffic-row">
                        <span class="label">Facebook</span>
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="segment seg-1" style="width: 33%;"></div>
                                <div class="segment seg-2" style="width: 33%;"></div>
                                <div class="segment seg-3" style="width: 34%;"></div>
                            </div>
                        </div>
                        <div class="percent">100%</div>
                    </div>

                          <!-- Facebook -->
                          <div class="traffic-row">
                            <span class="label">Pinterest</span>
                            <div class="progress-container">
                                <div class="progress-bar">
                                    <div class="segment seg-1" style="width: 33%;"></div>
                                    <div class="segment seg-2" style="width: 33%;"></div>
                                    <div class="segment seg-3" style="width: 34%;"></div>
                                </div>
                            </div>
                            <div class="percent">100%</div>
                        </div>


                            <!-- Facebook -->
                            <div class="traffic-row">
                                <span class="label">Twitter</span>
                                <div class="progress-container">
                                    <div class="progress-bar">
                                        <div class="segment seg-1" style="width: 33%;"></div>
                                        <div class="segment seg-2" style="width: 33%;"></div>
                                        <div class="segment seg-3" style="width: 34%;"></div>
                                    </div>
                                </div>
                                <div class="percent">80%</div>
                            </div>
                </div>
            </div>




            
            <div class="row g-3 mb-4">
                <div class="col-md-6">
                    <div class="card p-3">
                        <h6>Traffic by Age Group</h6><canvas id="ageChart"></canvas>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card p-3">
                        <div class="row">
                            <div class="col-sm-6">
                                <h6>Page Popularity</h6><canvas id="popularityChart"></canvas>
                            </div>
                            <div class="col-sm-6">
                                <div class="percentage-style">
                                    <div class="item">
                                        <span class="dot general"></span>
                                        <span class="label">General Dentistry</span>
                                        <span class="value">52.1%</span>
                                    </div>
                                    <div class="item active">
                                        <span class="dot pediatric"></span>
                                        <span class="label">Pediatric Dentistry</span>
                                        <span class="value">22.8%</span>
                                    </div>
                                    <div class="item">
                                        <span class="dot about"></span>
                                        <span class="label">About us</span>
                                        <span class="value">13.9%</span>
                                    </div>
                                    <div class="item">
                                        <span class="dot enquiry"></span>
                                        <span class="label">Enquiry form</span>
                                        <span class="value">11.2%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row g-3 mb-4">
                <div class="col-md-6">
                    <div class="card p-3">
                        <h6>Bounce Rate</h6><canvas id="bounceChart"></canvas>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card p-3">
                        <div class="row">
                            <div class="col-sm-6">
                                <h6>Traffic by Location</h6><canvas id="locationChart"></canvas>
                            </div>
                            <div class="col-sm-6">
                                <div class="percentage-style">
                                    <div class="item">
                                        <span class="dot general"></span>
                                        <span class="label">Coimbatore</span>
                                        <span class="value">52.1%</span>
                                    </div>
                                    <div class="item active">
                                        <span class="dot pediatric"></span>
                                        <span class="label">Tirupur</span>
                                        <span class="value">22.8%</span>
                                    </div>
                                    <div class="item">
                                        <span class="dot about"></span>
                                        <span class="label">Pollachi</span>
                                        <span class="value">13.9%</span>
                                    </div>
                                    <div class="item">
                                        <span class="dot enquiry"></span>
                                        <span class="label">Erode</span>
                                        <span class="value">11.2%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="trafficLegend" style="padding: 1rem;"></div>

            <div class="card p-4 mb-4">
                <h3 style="text-align: center; font-family: 'Segoe UI', sans-serif;">Global Visitors</h3>
                <div id="chartdiv"></div>

            </div>
        </div>

        <script>
            const now = new Date();
            const currentYear = now.getFullYear();
            const currentMonth = now.getMonth() + 1;
            const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

            const dummyYearData = {
                2023: Array.from({ length: 12 }, (_, i) => Math.floor(Math.random() * 2000 + 500)),
                2024: Array.from({ length: 12 }, (_, i) => Math.floor(Math.random() * 2500 + 600)),
                2025: Array.from({ length: 12 }, (_, i) => Math.floor(Math.random() * 3000 + 700))
            };

            const dummyMonthData = (year, monthIndex) =>
                Array.from({ length: new Date(year, monthIndex, 0).getDate() }, () => Math.floor(Math.random() * 200 + 50));

            function updateTitle(year, month) {
                const label = month && month !== '0'
                    ? `${monthNames[month - 1]} ${year}`
                    : `${year}`;
                document.getElementById("currentMonthYear").textContent = label;
            }

            let vChart;
            function drawVisitors(labels, currentData, lastMonthData = null) {
                if (vChart) vChart.destroy();

                const datasets = [{
                    label: 'This Month',
                    data: currentData,
                    borderColor: '#113f51',
                    backgroundColor: 'rgba(17,63,81,0.1)',
                    fill: true,
                    tension: 0.3,
                    borderWidth: 1
                }];

                if (lastMonthData) {
                    datasets.push({
                        label: 'Last Month',
                        data: lastMonthData,
                        borderColor: 'lightblue',
                        backgroundColor: 'transparent',
                        fill: false,
                        tension: 0.3,
                        borderWidth: 1
                    });
                }

                vChart = new Chart(document.getElementById("visitorsChart"), {
                    type: 'line',
                    data: {
                        labels,
                        datasets: datasets
                    },
                    options: { scales: { y: { beginAtZero: true } } }
                });
            }

            function onSelectChange() {
                const y = parseInt(document.getElementById("yearSelect").value);
                const m = parseInt(document.getElementById("monthSelect").value);

                if (!isNaN(y) && m !== 0) {
                    updateTitle(y, m);
                    const currentData = dummyMonthData(y, m);
                    const daysInCurrent = currentData.length;
                    const labels = [...Array(daysInCurrent).keys()].map(i => i + 1);

                    // Previous month logic
                    let lastMonth = m - 1;
                    let lastMonthYear = y;
                    if (lastMonth === 0) {
                        lastMonth = 12;
                        lastMonthYear = y - 1;
                    }
                    const lastMonthData = dummyMonthData(lastMonthYear, lastMonth).slice(0, daysInCurrent);

                    drawVisitors(labels, currentData, lastMonthData);
                } else if (!isNaN(y)) {
                    updateTitle(y, null);
                    drawVisitors(monthNames, dummyYearData[y]);
                }
            }

            document.getElementById("yearSelect").addEventListener("change", onSelectChange);
            document.getElementById("monthSelect").addEventListener("change", onSelectChange);

            // âœ… Load default
            document.getElementById("yearSelect").value = currentYear.toString();
            document.getElementById("monthSelect").value = currentMonth.toString();
            updateTitle(currentYear, currentMonth);
            const initialData = dummyMonthData(currentYear, currentMonth);
            const daysInCurrent = initialData.length;
            const initialLabels = [...Array(daysInCurrent).keys()].map(i => i + 1);
            let lastMonth = currentMonth - 1;
            let lastMonthYear = currentYear;
            if (lastMonth === 0) {
                lastMonth = 12;
                lastMonthYear = currentYear - 1;
            }
            const lastMonthDataInit = dummyMonthData(lastMonthYear, lastMonth).slice(0, daysInCurrent);
            drawVisitors(initialLabels, initialData, lastMonthDataInit);

            // Static Charts remain the same
            new Chart(document.getElementById("ageChart"), {
                type: 'bar',
                data: {
                    labels: ['18-24', '25-34', '35-44', '45-54', '55-64', '65+'],
                    datasets: [{ data: [18000, 50000, 26000, 52000, 14000, 29000], backgroundColor: ['#46c6e6', '#0e3b46', '#237b88', '#e5cfab', '#f0efe9', '#50e3e6'] }]
                }
            });

            new Chart(document.getElementById("popularityChart"), {
                type: 'doughnut',
                data: {
                    labels: ['General Dentistry', 'Pediatric Dentistry', 'About Us', 'Enquiry'],
                    datasets: [{ data: [52.1, 22.8, 13.9, 11.2], backgroundColor: ['#7dd2ea', '#0f3f47', '#104c5a', '#e5cfab'] }]
                },
                options: {
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: c => c.label + ': ' + c.formattedValue + '%'
                            }
                        }
                    }
                }
            });

            new Chart(document.getElementById("bounceChart"), {
                type: 'bar',
                data: {
                    labels: ['1-5', '6-10', '11-15', '16-20', '21-25', '26-30'],
                    datasets: [{
                        label: 'Bounce',
                        data: [18000, 54000, 26000, 53000, 14000, 30000],
                        backgroundColor: ['#46c6e6', '#0e3b46', '#237b88', '#e5cfab', '#f0efe9', '#50e3e6']
                    }]
                }
            });

            new Chart(document.getElementById("locationChart"), {
                type: 'doughnut',
                data: {
                    labels: ['Coimbatore', 'Tirrupur', 'Pollachi', 'Erode'],
                    datasets: [{ data: [52.1, 22.8, 13.9, 11.2], backgroundColor: ['#7dd2ea', '#0f3f47', '#104c5a', '#e5cfab'] }]
                },
                options: {
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: c => c.label + ': ' + c.formattedValue + '%'
                            }
                        }
                    }
                }
            });

            // ------------------------- GLOBAL VISITORS ---------------------
            am5.ready(function () {
                var root = am5.Root.new("chartdiv");
                root.setThemes([am5themes_Animated.new(root)]);

                var chart = root.container.children.push(am5map.MapChart.new(root, {
                    panX: "rotateX",
                    panY: "none",
                    projection: am5map.geoMercator()
                }));

                var polygonSeries = chart.series.push(am5map.MapPolygonSeries.new(root, {
                    geoJSON: am5geodata_worldLow
                }));

                var pointSeries = chart.series.push(am5map.MapPointSeries.new(root, {
                    valueField: "value",
                    latitudeField: "latitude",
                    longitudeField: "longitude"
                }));

                pointSeries.bullets.push(function () {
                    return am5.Bullet.new(root, {
                        sprite: am5.Circle.new(root, {
                            radius: 6,
                            fill: am5.color(0xff0000),
                            tooltipText: "{title}"
                        })
                    });
                });

                pointSeries.data.setAll([
                    { title: "USA", latitude: 37.0902, longitude: -95.7129 },
                    { title: "India", latitude: 20.5937, longitude: 78.9629 },
                    { title: "Russia", latitude: 61.5240, longitude: 105.3188 },
                    { title: "China", latitude: 35.8617, longitude: 104.1954 },
                    { title: "Brazil", latitude: -14.2350, longitude: -51.9253 },
                    { title: "South Africa", latitude: -30.5595, longitude: 22.9375 },
                    { title: "Australia", latitude: -25.2744, longitude: 133.7751 },
                    { title: "Germany", latitude: 51.1657, longitude: 10.4515 },
                    { title: "Japan", latitude: 36.2048, longitude: 138.2529 },
                    { title: "Nigeria", latitude: 9.0820, longitude: 8.6753 }
                ]);

                chart.appear(1000, 100);
            });
        </script>
    </body>
</html>